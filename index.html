<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JestingsHub Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Supabase Config
    const SUPABASE_URL = 'https://vjpujincktcpxnorfgez.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZqcHVqaW5ja3RjcHhub3JmZ2V6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5ODE2MjQsImV4cCI6MjA4MzU1NzYyNH0.3VerE_yChawbS_9m5VW42VHVFRCGPPGhmDT8VZ6V-kY';
    const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  </script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --bg-primary: #f7f7f8;
      --bg-card: #ffffff;
      --text-primary: #1d1d1f;
      --text-secondary: #6e6e73;
      --text-tertiary: #86868b;
      --border-light: #e5e5e7;
      --icon-glyph: #3A3A3A;
      --cat-medical: #E8EEF6;
      --cat-legal: #EEEAF4;
      --cat-financial: #E9F2EC;
      --cat-home: #F2EFEA;
      --cat-vehicles: #EEF1F4;
      --cat-travel: #EAF2F7;
      --cat-receipts: #F5F1EA;
      --cat-providers: #F3F0E4;
      --cat-family: #EEEFFC;
      --cat-clubs: #EDF2EA;
      --accent-blue: #0071e3;
      --accent-blue-hover: #0077ed;
      --emergency-red: #ff3b30;
    }
    
    body {
      min-height: 100vh;
      background: var(--bg-primary);
      font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
    }
    
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 18px 40px;
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-light);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .logo { display: flex; align-items: center; gap: 12px; }
    
    .logo-icon {
      width: 34px; height: 34px;
      background: var(--text-primary);
      border-radius: 9px;
      display: flex; align-items: center; justify-content: center;
      color: white; font-size: 16px;
      cursor: pointer; transition: all 0.2s ease;
      overflow: hidden; position: relative;
    }
    
    .logo-icon:hover { transform: scale(1.05); box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
    .logo-icon img { width: 100%; height: 100%; object-fit: cover; }
    .logo-icon-edit {
      position: absolute; bottom: -2px; right: -2px;
      width: 14px; height: 14px;
      background: var(--accent-blue); border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 8px; opacity: 0; transition: opacity 0.2s ease;
    }
    .logo-icon:hover .logo-icon-edit { opacity: 1; }
    #logoUpload { display: none; }
    .logo-text { font-size: 18px; font-weight: 600; color: var(--text-primary); letter-spacing: -0.3px; }
    
    .header-right { display: flex; align-items: center; gap: 16px; }
    
    .emergency-button {
      display: flex; align-items: center; gap: 8px;
      padding: 9px 16px;
      background: var(--emergency-red); border: none; border-radius: 980px;
      color: white; font-size: 13px; font-weight: 600;
      cursor: pointer; transition: all 0.2s ease;
    }
    .emergency-button:hover { filter: brightness(0.95); transform: scale(1.02); }
    
    .avatar-group { display: flex; align-items: center; }
    .avatar {
      width: 34px; height: 34px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; color: white; font-weight: 600;
      border: 2px solid white; box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .avatar-j { background: #7D8597; }
    .avatar-l { background: #8E9AAB; margin-left: -8px; }
    
    main { max-width: 1180px; margin: 0 auto; padding: 28px 40px 60px; }
    
    .dashboard-view.hidden { display: none; }
    .category-detail { display: none; animation: slideUp 0.3s ease-out; }
    .category-detail.active { display: block; }
    
    .ai-section { margin-bottom: 28px; animation: slideUp 0.4s ease-out; }
    .ai-container {
      background: var(--bg-card); border-radius: 18px; padding: 28px 32px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04), 0 4px 12px rgba(0, 0, 0, 0.03);
    }
    .ai-header { display: flex; align-items: center; gap: 16px; margin-bottom: 22px; }
    .ai-orb {
      width: 48px; height: 48px; border-radius: 14px;
      background: var(--text-primary);
      display: flex; align-items: center; justify-content: center;
      animation: float 5s ease-in-out infinite; flex-shrink: 0;
    }
    .ai-symbol { font-size: 20px; color: white; }
    .ai-title-block { flex: 1; }
    .ai-title { font-size: 20px; font-weight: 600; color: var(--text-primary); margin-bottom: 3px; letter-spacing: -0.3px; }
    .ai-subtitle { font-size: 14px; color: var(--text-secondary); }
    
    .ai-input-wrapper { display: flex; gap: 10px; margin-bottom: 16px; }
    .ai-input {
      flex: 1; padding: 14px 18px; font-size: 15px;
      border: 1px solid var(--border-light); border-radius: 11px;
      background: var(--bg-primary); color: var(--text-primary);
      transition: all 0.2s ease; font-family: "Inter", sans-serif;
    }
    .ai-input:focus { outline: none; border-color: var(--accent-blue); background: white; box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1); }
    .ai-input::placeholder { color: var(--text-tertiary); }
    .ai-submit {
      width: 48px; height: 48px; border-radius: 11px; border: none;
      background: var(--accent-blue); cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s ease; font-size: 18px; color: white;
    }
    .ai-submit:hover { background: var(--accent-blue-hover); }
    
    .quick-actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .quick-action {
      display: flex; align-items: center; gap: 7px; padding: 9px 14px;
      background: var(--bg-primary); border: 1px solid var(--border-light); border-radius: 980px;
      font-size: 13px; color: var(--text-primary); cursor: pointer;
      transition: all 0.15s ease; font-family: "Inter", sans-serif; font-weight: 500;
    }
    .quick-action:hover { background: #eeeef0; border-color: #d8d8db; }
    .quick-action.primary { background: var(--text-primary); border-color: var(--text-primary); color: white; }
    .quick-action.primary:hover { background: #2d2d2f; }
    .quick-action span { font-size: 14px; }
    
    .stats-bar {
      display: flex; justify-content: center; align-items: center; gap: 28px;
      padding: 16px 32px; background: var(--bg-card); border-radius: 14px;
      margin-bottom: 28px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03);
    }
    .stat { display: flex; flex-direction: column; align-items: center; gap: 3px; }
    .stat-number { font-size: 26px; font-weight: 700; color: var(--text-primary); letter-spacing: -0.5px; }
    .stat-label { font-size: 11px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.4px; font-weight: 500; }
    .stat-divider { width: 1px; height: 44px; background: var(--border-light); }
    
    .fun-btn {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      gap: 4px; width: 72px; height: 72px; border: none; border-radius: 50%;
      cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .fun-btn:hover { transform: scale(1.08); box-shadow: 0 6px 20px rgba(0,0,0,0.2); }
    .fun-btn:active { transform: scale(0.95); box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
    .complaint-btn { background: var(--emergency-red); }
    .complaint-btn:hover { background: #e6352b; }
    .complaint-btn .fun-icon { font-size: 24px; color: white; }
    .complaint-btn .fun-label { font-size: 9px; color: rgba(255,255,255,0.9); font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; }
    .husband-btn { background: var(--text-primary); }
    .husband-btn:hover { background: #2d2d2f; }
    .husband-btn .fun-icon { font-size: 24px; color: white; }
    .husband-btn .fun-label { font-size: 8px; color: rgba(255,255,255,0.9); font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; line-height: 1.1; text-align: center; }
    
    .categories-section { margin-bottom: 28px; }
    .section-title { font-size: 17px; font-weight: 600; color: var(--text-primary); margin-bottom: 14px; letter-spacing: -0.2px; }
    .categories-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(175px, 1fr)); gap: 10px; }
    .category-card {
      display: flex; align-items: center; gap: 12px; padding: 14px 16px;
      background: var(--bg-card); border-radius: 12px; cursor: pointer;
      transition: all 0.15s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    }
    .category-card:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .category-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; color: var(--icon-glyph); }
    .category-info { flex: 1; display: flex; flex-direction: column; gap: 1px; min-width: 0; }
    .category-name { font-size: 14px; font-weight: 600; color: var(--text-primary); }
    .category-subtitle { font-size: 12px; color: var(--text-tertiary); }
    .category-badge { padding: 3px 9px; background: var(--bg-primary); border-radius: 980px; font-size: 12px; font-weight: 600; color: var(--text-secondary); }
    
    .bottom-panels { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
    @media (max-width: 900px) { .bottom-panels { grid-template-columns: 1fr; } }
    .panel { background: var(--bg-card); border-radius: 14px; padding: 22px; box-shadow: 0 1px 3px rgba(0,0,0,0.03); }
    .panel-title { display: flex; align-items: center; gap: 9px; font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: 16px; }
    .panel-icon { font-size: 15px; color: var(--text-secondary); }
    .activity-list { display: flex; flex-direction: column; gap: 14px; }
    .activity-item { display: flex; align-items: flex-start; gap: 11px; }
    .activity-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent-blue); margin-top: 6px; flex-shrink: 0; }
    .activity-content { display: flex; flex-direction: column; gap: 2px; }
    .activity-text { font-size: 14px; color: var(--text-primary); font-weight: 500; }
    .activity-meta { font-size: 12px; color: var(--text-tertiary); }
    .reminder-list { display: flex; flex-direction: column; gap: 11px; }
    .reminder-item { display: flex; align-items: center; gap: 11px; }
    .reminder-date { padding: 5px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; color: var(--text-secondary); flex-shrink: 0; background: var(--bg-primary); }
    .reminder-date.urgent { background: #FFEFEE; color: var(--emergency-red); }
    .reminder-text { font-size: 14px; color: var(--text-primary); flex: 1; }
    .urgent-badge { padding: 3px 8px; background: var(--emergency-red); border-radius: 980px; font-size: 11px; font-weight: 600; color: white; }
    .quick-add-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 9px; margin-bottom: 14px; }
    .quick-add-btn { display: flex; flex-direction: column; align-items: center; gap: 7px; padding: 14px 10px; background: var(--bg-primary); border: none; border-radius: 10px; cursor: pointer; transition: all 0.15s ease; color: var(--text-primary); font-size: 12px; font-weight: 500; font-family: "Inter", sans-serif; }
    .quick-add-btn:hover { background: #eeeef0; }
    .quick-add-icon { font-size: 20px; }
    .email-hint { display: flex; align-items: center; gap: 9px; padding: 12px 14px; background: var(--bg-primary); border-radius: 10px; font-size: 12px; color: var(--text-tertiary); }
    .email-hint strong { color: var(--text-primary); }
    
    /* Category Detail View */
    .detail-header { display: flex; align-items: center; gap: 16px; margin-bottom: 28px; }
    .back-btn { width: 42px; height: 42px; border-radius: 50%; border: 1px solid var(--border-light); background: var(--bg-card); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; color: var(--text-secondary); transition: all 0.15s ease; }
    .back-btn:hover { background: var(--bg-primary); border-color: #d0d0d3; }
    .detail-title-section { flex: 1; display: flex; align-items: center; gap: 14px; }
    .detail-icon { width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 22px; color: var(--icon-glyph); }
    .detail-title-info h2 { font-size: 24px; font-weight: 700; color: var(--text-primary); letter-spacing: -0.3px; }
    .detail-title-info span { font-size: 14px; color: var(--text-tertiary); }
    .add-doc-btn { display: flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--text-primary); color: white; border: none; border-radius: 980px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.15s ease; font-family: "Inter", sans-serif; }
    .add-doc-btn:hover { background: #2d2d2f; transform: scale(1.02); }
    
    .documents-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 14px; margin-bottom: 28px; }
    .document-card { background: var(--bg-card); border-radius: 14px; padding: 18px; box-shadow: 0 1px 3px rgba(0,0,0,0.04); transition: all 0.15s ease; cursor: pointer; position: relative; }
    .document-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); transform: translateY(-1px); }
    .document-card-header { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 12px; }
    .doc-type-icon { width: 44px; height: 44px; border-radius: 10px; background: var(--bg-primary); display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
    .doc-type-icon.pdf { background: #FFEBE9; color: #D93025; }
    .doc-type-icon.image { background: #E8F5E9; color: #34A853; }
    .doc-type-icon.doc { background: #E3F2FD; color: #1A73E8; }
    .doc-info { flex: 1; min-width: 0; }
    .doc-name { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .doc-meta { font-size: 12px; color: var(--text-tertiary); }
    .doc-notes { font-size: 13px; color: var(--text-secondary); line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .doc-actions { position: absolute; top: 12px; right: 12px; display: flex; gap: 6px; opacity: 0; transition: opacity 0.15s ease; }
    .document-card:hover .doc-actions { opacity: 1; }
    .doc-action-btn { width: 30px; height: 30px; border-radius: 8px; border: none; background: var(--bg-primary); cursor: pointer; font-size: 14px; color: var(--text-secondary); transition: all 0.15s ease; }
    .doc-action-btn:hover { background: #e8e8ed; }
    .doc-action-btn.delete:hover { background: #FFEBE9; color: var(--emergency-red); }
    
    .empty-state { text-align: center; padding: 60px 20px; color: var(--text-tertiary); }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .empty-state h3 { font-size: 18px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; }
    .empty-state p { font-size: 14px; margin-bottom: 20px; }
    
    /* Modals */
    .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.4); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px); }
    .modal.active { display: flex; }
    .modal-content { background: white; border-radius: 20px; padding: 28px; width: 90%; max-width: 480px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); animation: popIn 0.25s ease-out; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
    .modal-title { font-size: 20px; font-weight: 600; color: var(--text-primary); }
    .close-btn { width: 30px; height: 30px; border-radius: 50%; border: none; background: var(--bg-primary); cursor: pointer; font-size: 16px; color: var(--text-tertiary); transition: all 0.15s ease; }
    .close-btn:hover { background: #eeeef0; }
    .form-group { margin-bottom: 20px; }
    .form-label { display: block; font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.3px; }
    .form-input { width: 100%; padding: 14px 16px; font-size: 15px; border: 1px solid var(--border-light); border-radius: 10px; background: var(--bg-primary); color: var(--text-primary); font-family: "Inter", sans-serif; transition: all 0.15s ease; }
    .form-input:focus { outline: none; border-color: var(--accent-blue); background: white; box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.1); }
    .form-textarea { resize: vertical; min-height: 80px; }
    .file-upload-area { border: 2px dashed var(--border-light); border-radius: 12px; padding: 32px 20px; text-align: center; cursor: pointer; transition: all 0.15s ease; background: var(--bg-primary); }
    .file-upload-area:hover { border-color: var(--accent-blue); background: #f0f7ff; }
    .file-upload-area.has-file { border-color: #34A853; background: #E8F5E9; }
    .file-upload-icon { font-size: 32px; margin-bottom: 12px; }
    .file-upload-text { font-size: 14px; color: var(--text-secondary); margin-bottom: 4px; }
    .file-upload-hint { font-size: 12px; color: var(--text-tertiary); }
    .file-input { display: none; }
    .modal-actions { display: flex; gap: 10px; margin-top: 24px; }
    .btn { flex: 1; padding: 14px 20px; border-radius: 10px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.15s ease; font-family: "Inter", sans-serif; }
    .btn-secondary { background: var(--bg-primary); border: 1px solid var(--border-light); color: var(--text-primary); }
    .btn-secondary:hover { background: #eeeef0; }
    .btn-primary { background: var(--text-primary); border: none; color: white; }
    .btn-primary:hover { background: #2d2d2f; }
    .btn-danger { background: var(--emergency-red); border: none; color: white; }
    .btn-danger:hover { background: #e6352b; }
    
    .view-modal .modal-content { max-width: 600px; }
    .view-doc-preview { background: var(--bg-primary); border-radius: 12px; padding: 40px; text-align: center; margin-bottom: 20px; }
    .view-doc-preview img { max-width: 100%; max-height: 300px; border-radius: 8px; }
    .view-doc-preview .preview-icon { font-size: 64px; margin-bottom: 12px; }
    .view-doc-details { display: grid; gap: 12px; }
    .view-doc-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border-light); }
    .view-doc-row:last-child { border-bottom: none; }
    .view-doc-label { font-size: 13px; color: var(--text-tertiary); font-weight: 500; }
    .view-doc-value { font-size: 14px; color: var(--text-primary); font-weight: 500; text-align: right; max-width: 60%; }
    
    .fun-modal-content { background: white; border-radius: 24px; padding: 40px 48px; text-align: center; box-shadow: 0 25px 80px rgba(0,0,0,0.15); max-width: 400px; animation: popIn 0.3s ease-out; }
    .fun-modal-icon { font-size: 64px; margin-bottom: 16px; }
    .fun-modal-title { font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 8px; }
    .fun-modal-message { font-size: 16px; color: var(--text-secondary); line-height: 1.5; }
    .fun-modal-close { margin-top: 24px; padding: 10px 28px; background: var(--text-primary); color: white; border: none; border-radius: 980px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
    .fun-modal-close:hover { background: #2d2d2f; }

    .cat-medical { background: var(--cat-medical); }
    .cat-legal { background: var(--cat-legal); }
    .cat-financial { background: var(--cat-financial); }
    .cat-home { background: var(--cat-home); }
    .cat-vehicles { background: var(--cat-vehicles); }
    .cat-travel { background: var(--cat-travel); }
    .cat-receipts { background: var(--cat-receipts); }
    .cat-providers { background: var(--cat-providers); }
    .cat-family { background: var(--cat-family); }
    .cat-clubs { background: var(--cat-clubs); }

    /* Providers Directory */
    .providers-view { display: none; animation: slideUp 0.3s ease-out; }
    .providers-view.active { display: block; }
    
    .providers-controls {
      display: flex; gap: 12px; margin-bottom: 20px; align-items: center; flex-wrap: wrap;
    }
    
    .search-box {
      flex: 1; min-width: 200px; position: relative;
    }
    .search-box input {
      width: 100%; padding: 12px 16px 12px 42px; font-size: 14px;
      border: 1px solid var(--border-light); border-radius: 10px;
      background: var(--bg-card); color: var(--text-primary);
      font-family: "Inter", sans-serif;
    }
    .search-box input:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(0,113,227,0.1); }
    .search-box input::placeholder { color: var(--text-tertiary); }
    .search-box-icon {
      position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      font-size: 16px; color: var(--text-tertiary); pointer-events: none;
    }
    
    .filter-dropdown {
      padding: 12px 16px; font-size: 14px; border: 1px solid var(--border-light);
      border-radius: 10px; background: var(--bg-card); color: var(--text-primary);
      font-family: "Inter", sans-serif; cursor: pointer; min-width: 160px;
    }
    .filter-dropdown:focus { outline: none; border-color: var(--accent-blue); }
    
    .view-toggle {
      display: flex; background: var(--bg-primary); border-radius: 10px; padding: 4px;
    }
    .view-toggle-btn {
      padding: 8px 14px; border: none; background: transparent; border-radius: 8px;
      cursor: pointer; font-size: 16px; color: var(--text-tertiary); transition: all 0.15s ease;
    }
    .view-toggle-btn.active {
      background: var(--bg-card); color: var(--text-primary); box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .view-toggle-btn:hover:not(.active) { color: var(--text-secondary); }
    
    .providers-count {
      font-size: 13px; color: var(--text-tertiary); margin-left: auto;
    }
    
    .providers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 14px; }
    .providers-grid.list-view { grid-template-columns: 1fr; gap: 8px; }
    
    .provider-card {
      background: var(--bg-card); border-radius: 14px; padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04); transition: all 0.15s ease;
      position: relative;
    }
    .provider-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    
    /* List view styles */
    .providers-grid.list-view .provider-card {
      padding: 14px 18px; border-radius: 10px;
      display: flex; align-items: center; gap: 16px;
    }
    .providers-grid.list-view .provider-header { margin-bottom: 0; flex: 1; }
    .providers-grid.list-view .provider-avatar { width: 40px; height: 40px; font-size: 18px; border-radius: 10px; }
    .providers-grid.list-view .provider-name { font-size: 15px; }
    .providers-grid.list-view .provider-contact { flex-direction: row; gap: 8px; margin-bottom: 0; }
    .providers-grid.list-view .provider-contact-row { padding: 8px 12px; font-size: 13px; }
    .providers-grid.list-view .provider-notes { display: none; }
    .providers-grid.list-view .provider-actions { position: static; opacity: 1; }
    
    .provider-header { display: flex; align-items: flex-start; gap: 14px; margin-bottom: 14px; }
    
    .provider-avatar {
      width: 48px; height: 48px; border-radius: 12px;
      background: var(--cat-providers); display: flex; align-items: center; justify-content: center;
      font-size: 20px; color: var(--icon-glyph); flex-shrink: 0;
    }
    
    .provider-info { flex: 1; min-width: 0; }
    .provider-name { font-size: 16px; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .provider-type { font-size: 13px; color: var(--text-tertiary); font-weight: 500; }
    
    .provider-actions {
      position: absolute; top: 12px; right: 12px;
      display: flex; gap: 6px; opacity: 0; transition: opacity 0.15s ease;
    }
    .provider-card:hover .provider-actions { opacity: 1; }
    
    .provider-contact { display: flex; flex-direction: column; gap: 8px; }
    
    .provider-contact-row {
      display: flex; align-items: center; gap: 10px;
      padding: 10px 12px; background: var(--bg-primary); border-radius: 8px;
      font-size: 14px; color: var(--text-primary); cursor: pointer;
      transition: all 0.15s ease; text-decoration: none;
    }
    .provider-contact-row:hover { background: #eeeef0; }
    .provider-contact-row span:first-child { font-size: 16px; }
    .provider-contact-row.phone { color: #34A853; }
    .provider-contact-row.email { color: var(--accent-blue); }
    
    .provider-notes { font-size: 13px; color: var(--text-secondary); margin-top: 12px; line-height: 1.4; }
    
    .no-results { text-align: center; padding: 40px 20px; color: var(--text-tertiary); }
    .no-results-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.5; }
    .no-results h3 { font-size: 16px; font-weight: 600; color: var(--text-secondary); margin-bottom: 4px; }
    .no-results p { font-size: 14px; }

    /* Reminders */
    .reminders-view { display: none; animation: slideUp 0.3s ease-out; }
    .reminders-view.active { display: block; }
    
    .reminders-list { display: flex; flex-direction: column; gap: 10px; }
    
    .reminder-card {
      background: var(--bg-card); border-radius: 12px; padding: 16px 18px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04); transition: all 0.15s ease;
      display: flex; align-items: center; gap: 14px; position: relative;
    }
    .reminder-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    
    .reminder-card.overdue { border-left: 3px solid var(--emergency-red); }
    .reminder-card.urgent { border-left: 3px solid #FF9500; }
    .reminder-card.upcoming { border-left: 3px solid var(--accent-blue); }
    .reminder-card.later { border-left: 3px solid var(--border-light); }
    
    .reminder-date-box {
      width: 54px; height: 54px; border-radius: 10px; background: var(--bg-primary);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      flex-shrink: 0;
    }
    .reminder-date-box.overdue { background: #FFEBE9; }
    .reminder-date-box.urgent { background: #FFF3E0; }
    .reminder-date-box.upcoming { background: #E3F2FD; }
    
    .reminder-date-month { font-size: 11px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; }
    .reminder-date-day { font-size: 20px; font-weight: 700; color: var(--text-primary); line-height: 1; }
    .reminder-date-box.overdue .reminder-date-month,
    .reminder-date-box.overdue .reminder-date-day { color: var(--emergency-red); }
    .reminder-date-box.urgent .reminder-date-month,
    .reminder-date-box.urgent .reminder-date-day { color: #E65100; }
    .reminder-date-box.upcoming .reminder-date-month,
    .reminder-date-box.upcoming .reminder-date-day { color: var(--accent-blue); }
    
    .reminder-content { flex: 1; min-width: 0; }
    .reminder-title { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: 3px; }
    .reminder-meta { font-size: 13px; color: var(--text-tertiary); display: flex; align-items: center; gap: 8px; }
    .reminder-link { color: var(--accent-blue); cursor: pointer; }
    .reminder-link:hover { text-decoration: underline; }
    
    .reminder-status {
      padding: 5px 10px; border-radius: 6px; font-size: 11px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.3px; flex-shrink: 0;
    }
    .reminder-status.overdue { background: var(--emergency-red); color: white; }
    .reminder-status.urgent { background: #FF9500; color: white; }
    .reminder-status.upcoming { background: var(--accent-blue); color: white; }
    .reminder-status.later { background: var(--bg-primary); color: var(--text-tertiary); }
    
    .reminder-actions {
      display: flex; gap: 6px; opacity: 0; transition: opacity 0.15s ease;
    }
    .reminder-card:hover .reminder-actions { opacity: 1; }
    
    .reminders-section-title {
      font-size: 13px; font-weight: 600; color: var(--text-tertiary);
      text-transform: uppercase; letter-spacing: 0.5px; margin: 24px 0 12px;
    }
    .reminders-section-title:first-child { margin-top: 0; }
    
    /* Dashboard reminder item clickable */
    .reminder-item.clickable { cursor: pointer; transition: all 0.15s ease; border-radius: 8px; padding: 8px; margin: -8px; }
    .reminder-item.clickable:hover { background: var(--bg-primary); }

    /* Search Results */
    .search-view { display: none; animation: slideUp 0.3s ease-out; }
    .search-view.active { display: block; }
    
    .search-header {
      display: flex; align-items: center; gap: 16px; margin-bottom: 24px;
    }
    .search-input-large {
      flex: 1; padding: 16px 20px 16px 48px; font-size: 17px;
      border: 1px solid var(--border-light); border-radius: 14px;
      background: var(--bg-card); color: var(--text-primary);
      font-family: "Inter", sans-serif; position: relative;
    }
    .search-input-large:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(0,113,227,0.1); }
    .search-input-wrapper { flex: 1; position: relative; }
    .search-input-wrapper .search-box-icon { left: 18px; font-size: 18px; }
    
    .search-results-summary {
      font-size: 14px; color: var(--text-tertiary); margin-bottom: 20px;
    }
    .search-results-summary strong { color: var(--text-primary); }
    
    .search-section { margin-bottom: 28px; }
    .search-section-title {
      font-size: 13px; font-weight: 600; color: var(--text-tertiary);
      text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;
      display: flex; align-items: center; gap: 8px;
    }
    .search-section-count {
      background: var(--bg-primary); padding: 2px 8px; border-radius: 10px;
      font-size: 12px; color: var(--text-secondary);
    }
    
    .search-results-grid { display: flex; flex-direction: column; gap: 8px; }
    
    .search-result-item {
      display: flex; align-items: center; gap: 14px;
      padding: 14px 16px; background: var(--bg-card); border-radius: 12px;
      cursor: pointer; transition: all 0.15s ease;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }
    .search-result-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.08); transform: translateX(4px); }
    
    .search-result-icon {
      width: 42px; height: 42px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; flex-shrink: 0;
    }
    
    .search-result-content { flex: 1; min-width: 0; }
    .search-result-title {
      font-size: 15px; font-weight: 600; color: var(--text-primary);
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .search-result-title mark { background: #FFF3C4; padding: 0 2px; border-radius: 2px; }
    .search-result-meta { font-size: 13px; color: var(--text-tertiary); margin-top: 2px; }
    .search-result-meta mark { background: #FFF3C4; padding: 0 2px; border-radius: 2px; }
    
    .search-result-badge {
      padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.3px; flex-shrink: 0;
      background: var(--bg-primary); color: var(--text-secondary);
    }
    
    .search-empty {
      text-align: center; padding: 60px 20px;
    }
    .search-empty-icon { font-size: 56px; margin-bottom: 16px; opacity: 0.4; }
    .search-empty h3 { font-size: 18px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; }
    .search-empty p { font-size: 14px; color: var(--text-tertiary); max-width: 300px; margin: 0 auto; }
    
    .search-suggestions {
      display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 20px;
    }
    .search-suggestion {
      padding: 8px 14px; background: var(--bg-card); border: 1px solid var(--border-light);
      border-radius: 980px; font-size: 13px; color: var(--text-secondary);
      cursor: pointer; transition: all 0.15s ease;
    }
    .search-suggestion:hover { border-color: var(--accent-blue); color: var(--accent-blue); }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <div class="logo-icon" onclick="document.getElementById('logoUpload').click()" title="Click to change icon">
        <span id="logoDefault">‚ú¶</span>
        <img id="logoImage" style="display: none;" alt="Logo">
        <div class="logo-icon-edit">‚úé</div>
      </div>
      <input type="file" id="logoUpload" accept="image/*" onchange="handleLogoUpload(event)">
      <span class="logo-text">JestingsHub</span>
    </div>
    <div class="header-right">
      <button class="emergency-button" onclick="toggleEmergency()">
        <span>‚ö°</span> Emergency Card
      </button>
      <div class="avatar-group">
        <div class="avatar avatar-j">J</div>
        <div class="avatar avatar-l">L</div>
      </div>
    </div>
  </header>

  <main>
    <!-- Dashboard View -->
    <div class="dashboard-view" id="dashboardView">
      <section class="ai-section">
        <div class="ai-container">
          <div class="ai-header">
            <div class="ai-orb"><span class="ai-symbol">‚ú¶</span></div>
            <div class="ai-title-block">
              <h2 class="ai-title">ü§ñ Ask JestingsHub AI</h2>
              <p class="ai-subtitle">Ask questions about your documents, providers, and reminders</p>
            </div>
          </div>
          <div class="ai-input-wrapper">
            <input class="ai-input" id="dashboardSearch" type="text" placeholder="Ask me anything... 'When does the passport expire?'" onkeydown="handleSearchKeydown(event)">
            <button class="ai-submit" onclick="openSearchFromDashboard()">‚Üí</button>
          </div>
          <div class="quick-actions">
            <button class="quick-action primary" onclick="openAddDocModal()"><span>üì§</span> Upload Document</button>
            <button class="quick-action" onclick="openSearchView()"><span>üîç</span> Search All</button>
            <button class="quick-action"><span>üìß</span> Forward Email</button>
            <button class="quick-action"><span>üì∏</span> Snap Document</button>
            <button class="quick-action" onclick="exportToICal()"><span>üìÖ</span> Export to Calendar</button>
          </div>
        </div>
      </section>

      <section class="stats-bar">
        <button class="fun-btn complaint-btn" onclick="showComplaint()">
          <span class="fun-icon">‚úã</span>
          <span class="fun-label">Complaint</span>
        </button>
        <div class="stat-divider"></div>
        <div class="stat">
          <span class="stat-number" id="totalDocs">0</span>
          <span class="stat-label">Documents</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat">
          <span class="stat-number">11</span>
          <span class="stat-label">Categories</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat" style="cursor: pointer;" onclick="openRemindersView()">
          <span class="stat-number" id="upcomingCount">0</span>
          <span class="stat-label">Upcoming</span>
        </div>
        <div class="stat-divider"></div>
        <div class="stat">
          <span class="stat-number" id="thisMonthDocs">0</span>
          <span class="stat-label">This Month</span>
        </div>
        <div class="stat-divider"></div>
        <button class="fun-btn husband-btn" onclick="showHusband()">
          <span class="fun-icon">‚òÖ</span>
          <span class="fun-label">Great<br>Husband</span>
        </button>
      </section>

      <section class="categories-section">
        <h3 class="section-title">Your Categories</h3>
        <div class="categories-grid" id="categoriesGrid"></div>
      </section>

      <section class="bottom-panels">
        <div class="panel">
          <h3 class="panel-title"><span class="panel-icon">‚óâ</span> Recent Activity</h3>
          <div class="activity-list" id="recentActivity"></div>
        </div>
        <div class="panel">
          <h3 class="panel-title" style="cursor: pointer;" onclick="openRemindersView()"><span class="panel-icon">‚ó∑</span> Upcoming Reminders</h3>
          <div class="reminder-list" id="dashboardReminders"></div>
          <div style="margin-top: 12px;">
            <button class="quick-action" onclick="openAddReminderModal()" style="width: 100%; justify-content: center;"><span>+</span> Add Reminder</button>
          </div>
        </div>
        <div class="panel">
          <h3 class="panel-title"><span class="panel-icon">+</span> Quick Add</h3>
          <div class="quick-add-grid">
            <button class="quick-add-btn" onclick="openAddDocModal()"><span class="quick-add-icon">üìß</span><span>Forward Email</span></button>
            <button class="quick-add-btn" onclick="openAddDocModal()"><span class="quick-add-icon">üì∑</span><span>Photo Upload</span></button>
            <button class="quick-add-btn" onclick="openAddDocModal()"><span class="quick-add-icon">üìù</span><span>Manual Entry</span></button>
            <button class="quick-add-btn" onclick="openAddProviderModal()"><span class="quick-add-icon">üë§</span><span>Add Provider</span></button>
          </div>
          <div class="email-hint"><span>‚úâÔ∏è</span><span>Forward emails to <strong><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ed84838f8295ad87889e9984838a9e85988fc38c84">[email&#160;protected]</a></strong></span></div>
        </div>
      </section>
    </div>

    <!-- Category Detail View -->
    <div class="category-detail" id="categoryDetail">
      <div class="detail-header">
        <button class="back-btn" onclick="goBackToDashboard()">‚Üê</button>
        <div class="detail-title-section">
          <div class="detail-icon" id="detailIcon">‚ô•</div>
          <div class="detail-title-info">
            <h2 id="detailTitle">Medical</h2>
            <span id="detailSubtitle">Joni ¬∑ 12 documents</span>
          </div>
        </div>
        <button class="add-doc-btn" onclick="openAddDocModal()"><span>+</span> Add Document</button>
      </div>
      <div class="documents-grid" id="documentsGrid"></div>
      <div class="empty-state" id="emptyState" style="display: none;">
        <div class="empty-state-icon">üìÅ</div>
        <h3>No documents yet</h3>
        <p>Add your first document to this category</p>
        <button class="add-doc-btn" onclick="openAddDocModal()"><span>+</span> Add Document</button>
      </div>
    </div>

    <!-- Providers View -->
    <div class="providers-view" id="providersView">
      <div class="detail-header">
        <button class="back-btn" onclick="goBackToDashboard()">‚Üê</button>
        <div class="detail-title-section">
          <div class="detail-icon cat-providers">üìû</div>
          <div class="detail-title-info">
            <h2>Providers</h2>
            <span id="providersSubtitle">Service Contacts ¬∑ 0 providers</span>
          </div>
        </div>
        <button class="add-doc-btn" onclick="openAddProviderModal()"><span>+</span> Add Provider</button>
      </div>
      
      <div class="providers-controls">
        <div class="search-box">
          <span class="search-box-icon">üîç</span>
          <input type="text" id="providerSearch" placeholder="Search providers..." oninput="filterProviders()">
        </div>
        <select class="filter-dropdown" id="providerFilter" onchange="filterProviders()">
          <option value="">All Types</option>
        </select>
        <div class="view-toggle">
          <button class="view-toggle-btn active" id="gridViewBtn" onclick="setProviderView('grid')" title="Grid view">‚ñ¶</button>
          <button class="view-toggle-btn" id="listViewBtn" onclick="setProviderView('list')" title="List view">‚ò∞</button>
        </div>
        <span class="providers-count" id="providersCount">0 providers</span>
      </div>
      
      <div class="providers-grid" id="providersGrid"></div>
      
      <div class="no-results" id="providersNoResults" style="display: none;">
        <div class="no-results-icon">üîç</div>
        <h3>No providers found</h3>
        <p>Try a different search or filter</p>
      </div>
      
      <div class="empty-state" id="providersEmptyState" style="display: none;">
        <div class="empty-state-icon">üë∑</div>
        <h3>No providers yet</h3>
        <p>Add your service contacts ‚Äî plumber, electrician, lawn care, etc.</p>
        <button class="add-doc-btn" onclick="openAddProviderModal()"><span>+</span> Add Provider</button>
      </div>
    </div>

    <!-- Reminders View -->
    <div class="reminders-view" id="remindersView">
      <div class="detail-header">
        <button class="back-btn" onclick="goBackToDashboard()">‚Üê</button>
        <div class="detail-title-section">
          <div class="detail-icon" style="background: #E3F2FD;">üîî</div>
          <div class="detail-title-info">
            <h2>Reminders</h2>
            <span id="remindersSubtitle">Upcoming ¬∑ 0 reminders</span>
          </div>
        </div>
        <button class="add-doc-btn" onclick="openAddReminderModal()"><span>+</span> Add Reminder</button>
        <button class="add-doc-btn" onclick="exportToICal()" style="background: var(--bg-primary); color: var(--text-primary); margin-left: 8px;"><span>üìÖ</span> Export</button>
      </div>
      
      <div class="reminders-list" id="remindersList"></div>
      
      <div class="empty-state" id="remindersEmptyState" style="display: none;">
        <div class="empty-state-icon">üîî</div>
        <h3>No reminders yet</h3>
        <p>Add expiration dates, renewals, and due dates to stay on top of things</p>
        <button class="add-doc-btn" onclick="openAddReminderModal()"><span>+</span> Add Reminder</button>
      </div>
    </div>

    <!-- Search View -->
    <div class="search-view" id="searchView">
      <div class="search-header">
        <button class="back-btn" onclick="goBackToDashboard()">‚Üê</button>
        <div class="search-input-wrapper">
          <span class="search-box-icon">üîç</span>
          <input type="text" class="search-input-large" id="searchInputLarge" placeholder="Search documents, providers, reminders..." oninput="performSearch()" autofocus>
        </div>
      </div>
      
      <div id="searchResultsContainer">
        <div class="search-empty" id="searchEmpty">
          <div class="search-empty-icon">‚ú¶</div>
          <h3>Search JestingsHub</h3>
          <p>Find documents, providers, and reminders across all your categories</p>
          <div class="search-suggestions">
            <span class="search-suggestion" onclick="searchFor('passport')">passport</span>
            <span class="search-suggestion" onclick="searchFor('insurance')">insurance</span>
            <span class="search-suggestion" onclick="searchFor('plumber')">plumber</span>
            <span class="search-suggestion" onclick="searchFor('expires')">expires</span>
          </div>
        </div>
        
        <div id="searchResults" style="display: none;"></div>
      </div>
    </div>
  </main>

  <!-- Modals -->
  <div class="modal" id="emergencyModal" onclick="toggleEmergency()">
    <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 420px;">
      <div class="modal-header">
        <span class="modal-title" style="color: var(--emergency-red);">‚ö° Emergency Access</span>
        <button class="close-btn" onclick="toggleEmergency()">‚úï</button>
      </div>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
        <div class="quick-add-btn" style="padding: 18px;"><span style="font-size: 24px;">ü™™</span><span>Driver's Licenses</span></div>
        <div class="quick-add-btn" style="padding: 18px;"><span style="font-size: 24px;">üè•</span><span>Insurance Cards</span></div>
        <div class="quick-add-btn" style="padding: 18px;"><span style="font-size: 24px;">üìã</span><span>Will & POA</span></div>
        <div class="quick-add-btn" style="padding: 18px;"><span style="font-size: 24px;">üõÇ</span><span>Passports</span></div>
      </div>
    </div>
  </div>

  <div class="modal" id="complaintModal" onclick="closeModal('complaintModal')">
    <div class="fun-modal-content" onclick="event.stopPropagation()">
      <div class="fun-modal-icon">üè†</div>
      <div class="fun-modal-title">Complaint Department</div>
      <div class="fun-modal-message">Life is so good at this house that there is no reason to complain!<br><br>Now go hit the Great Husband button üëâ</div>
      <button class="fun-modal-close" onclick="closeModal('complaintModal')">You're Right!</button>
    </div>
  </div>

  <div class="modal" id="husbandModal" onclick="closeModal('husbandModal')">
    <div class="fun-modal-content" onclick="event.stopPropagation()">
      <div class="fun-modal-icon">üèÜ</div>
      <div class="fun-modal-title">What a Great Husband!</div>
      <div class="fun-modal-message">Thank you for acknowledging what a great husband you have!</div>
      <button class="fun-modal-close" onclick="closeModal('husbandModal')">He's The Best!</button>
    </div>
  </div>

  <div class="modal" id="addDocModal" onclick="closeModal('addDocModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <span class="modal-title">Add Document</span>
        <button class="close-btn" onclick="closeModal('addDocModal')">‚úï</button>
      </div>
      <div class="form-group">
        <label class="form-label">Category</label>
        <select class="form-input" id="docCategory"></select>
      </div>
      <div class="form-group">
        <label class="form-label">Document Name</label>
        <input type="text" class="form-input" id="docName" placeholder="e.g., Insurance Card - Blue Cross">
      </div>
      <div class="form-group">
        <label class="form-label">File (Optional)</label>
        <div class="file-upload-area" id="fileUploadArea" onclick="document.getElementById('docFile').click()">
          <div class="file-upload-icon">üìÑ</div>
          <div class="file-upload-text" id="fileUploadText">Click to upload or drag & drop</div>
          <div class="file-upload-hint">PDF, Images, or Documents</div>
        </div>
        <input type="file" class="file-input" id="docFile" onchange="handleFileSelect(event)">
      </div>
      <div class="form-group">
        <label class="form-label">Notes (Optional)</label>
        <textarea class="form-input form-textarea" id="docNotes" placeholder="Add any helpful notes..."></textarea>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeModal('addDocModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveDocument()">Save Document</button>
      </div>
    </div>
  </div>

  <div class="modal view-modal" id="viewDocModal" onclick="closeModal('viewDocModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <span class="modal-title" id="viewDocTitle">Document Name</span>
        <button class="close-btn" onclick="closeModal('viewDocModal')">‚úï</button>
      </div>
      <div class="view-doc-preview" id="viewDocPreview">
        <div class="preview-icon">üìÑ</div>
        <div class="file-upload-text">No file attached</div>
      </div>
      <div class="view-doc-details">
        <div class="view-doc-row"><span class="view-doc-label">Category</span><span class="view-doc-value" id="viewDocCategory">‚Äî</span></div>
        <div class="view-doc-row"><span class="view-doc-label">Added</span><span class="view-doc-value" id="viewDocDate">‚Äî</span></div>
        <div class="view-doc-row"><span class="view-doc-label">Notes</span><span class="view-doc-value" id="viewDocNotes">‚Äî</span></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-danger" onclick="deleteCurrentDoc()">Delete</button>
        <button class="btn btn-primary" onclick="closeModal('viewDocModal')">Done</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Provider Modal -->
  <div class="modal" id="providerModal" onclick="closeModal('providerModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <span class="modal-title" id="providerModalTitle">Add Provider</span>
        <button class="close-btn" onclick="closeModal('providerModal')">‚úï</button>
      </div>
      <div class="form-group">
        <label class="form-label">Name / Company</label>
        <input type="text" class="form-input" id="providerName" placeholder="e.g., Joe's Plumbing or John Smith">
      </div>
      <div class="form-group">
        <label class="form-label">Type</label>
        <select class="form-input" id="providerType">
          <option value="Plumber">Plumber</option>
          <option value="Electrician">Electrician</option>
          <option value="HVAC">HVAC</option>
          <option value="Lawn Care">Lawn Care</option>
          <option value="Pool Service">Pool Service</option>
          <option value="Handyman">Handyman</option>
          <option value="Pest Control">Pest Control</option>
          <option value="Cleaning">Cleaning</option>
          <option value="Roofing">Roofing</option>
          <option value="Painter">Painter</option>
          <option value="Landscaping">Landscaping</option>
          <option value="Appliance Repair">Appliance Repair</option>
          <option value="Locksmith">Locksmith</option>
          <option value="Garage Door">Garage Door</option>
          <option value="Security">Security</option>
          <option value="Internet/Cable">Internet/Cable</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Phone</label>
        <input type="tel" class="form-input" id="providerPhone" placeholder="(555) 123-4567">
      </div>
      <div class="form-group">
        <label class="form-label">Email (Optional)</label>
        <input type="email" class="form-input" id="providerEmail" placeholder="contact@example.com">
      </div>
      <div class="form-group">
        <label class="form-label">Notes (Optional)</label>
        <textarea class="form-input form-textarea" id="providerNotes" placeholder="e.g., Ask for Mike, usually available weekends"></textarea>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeModal('providerModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveProvider()">Save Provider</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Reminder Modal -->
  <div class="modal" id="reminderModal" onclick="closeModal('reminderModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <span class="modal-title" id="reminderModalTitle">Add Reminder</span>
        <button class="close-btn" onclick="closeModal('reminderModal')">‚úï</button>
      </div>
      <div class="form-group">
        <label class="form-label">Title</label>
        <input type="text" class="form-input" id="reminderTitle" placeholder="e.g., Passport expires, Car registration due">
      </div>
      <div class="form-group">
        <label class="form-label">Due Date</label>
        <input type="date" class="form-input" id="reminderDate">
      </div>
      <div class="form-group">
        <label class="form-label">Category (Optional)</label>
        <select class="form-input" id="reminderCategory">
          <option value="">None</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Notes (Optional)</label>
        <textarea class="form-input form-textarea" id="reminderNotes" placeholder="Add any details..."></textarea>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeModal('reminderModal')">Cancel</button>
        <button class="btn btn-primary" onclick="saveReminder()">Save Reminder</button>
      </div>
    </div>
  </div>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    // Categories Data
    const categories = [
      { id: 'medical-joni', name: 'Medical', subtitle: 'Joni', icon: '‚ô•', colorClass: 'cat-medical' },
      { id: 'medical-lee', name: 'Medical', subtitle: 'Lee', icon: '‚ô•', colorClass: 'cat-medical' },
      { id: 'legal', name: 'Legal', subtitle: 'Wills & IDs', icon: '‚öñ', colorClass: 'cat-legal' },
      { id: 'home', name: 'Home', subtitle: 'Deed & Repairs', icon: '‚åÇ', colorClass: 'cat-home' },
      { id: 'vehicles', name: 'Vehicles', subtitle: 'Registration', icon: '‚¨°', colorClass: 'cat-vehicles' },
      { id: 'clubs', name: 'Clubs', subtitle: 'Memberships', icon: '‚ú¶', colorClass: 'cat-clubs' },
      { id: 'travel', name: 'Travel', subtitle: 'Trips & Plans', icon: '‚Üó', colorClass: 'cat-travel' },
      { id: 'providers', name: 'Providers', subtitle: 'Contacts', icon: 'üìû', colorClass: 'cat-providers', isSpecial: true },
      { id: 'receipts', name: 'Receipts', subtitle: 'Purchases', icon: '‚ñ§', colorClass: 'cat-receipts' },
      { id: 'financial', name: 'Financial', subtitle: 'Tax & Statements', icon: '‚óé', colorClass: 'cat-financial' },
      { id: 'family', name: 'Family', subtitle: 'Docs & Misc', icon: '‚óá', colorClass: 'cat-family' }
    ];

    // Provider type icons
    const providerIcons = {
      'Plumber': 'üîß', 'Electrician': '‚ö°', 'HVAC': '‚ùÑÔ∏è', 'Lawn Care': 'üåø',
      'Pool Service': 'üèä', 'Handyman': 'üî®', 'Pest Control': 'üêú', 'Cleaning': 'üßπ',
      'Roofing': 'üè†', 'Painter': 'üé®', 'Landscaping': 'üå≥', 'Appliance Repair': 'üîå',
      'Locksmith': 'üîë', 'Garage Door': 'üöó', 'Security': 'üîí', 'Internet/Cable': 'üì°', 'Other': 'üë∑'
    };

    // State
    let documents = [];
    let providers = [];
    let reminders = [];
    let currentCategory = null;
    let currentViewingDoc = null;
    let currentEditingProvider = null;
    let currentEditingReminder = null;
    let selectedFile = null;
    let providerViewMode = localStorage.getItem('jestingshub-provider-view') || 'grid';
    let isLoading = true;

    // Provider types for filter
    const providerTypes = [
      'Plumber', 'Electrician', 'HVAC', 'Lawn Care', 'Pool Service', 'Handyman',
      'Pest Control', 'Cleaning', 'Roofing', 'Painter', 'Landscaping',
      'Appliance Repair', 'Locksmith', 'Garage Door', 'Security', 'Internet/Cable', 'Other'
    ];

    // Initialize
    async function init() {
      console.log('Starting init...');
      
      try {
        console.log('Connecting to Supabase...');
        
        // Test connection
        const { data: testData, error: testError } = await db.from('documents').select('count');
        console.log('Connection test:', JSON.stringify(testData), JSON.stringify(testError));
        
        if (testError) {
          console.error('Supabase connection error:', JSON.stringify(testError));
          alert('Database connection error: ' + (testError.message || JSON.stringify(testError)));
        }
        
        // Load from Supabase
        const [docsRes, provsRes, remRes] = await Promise.all([
          db.from('documents').select('*').order('created_at', { ascending: false }),
          db.from('providers').select('*').order('created_at', { ascending: false }),
          db.from('reminders').select('*').order('date', { ascending: true })
        ]);

        console.log('Docs response:', JSON.stringify(docsRes));
        console.log('Providers response:', JSON.stringify(provsRes));
        console.log('Reminders response:', JSON.stringify(remRes));

        if (docsRes.error) console.error('Docs error:', JSON.stringify(docsRes.error));
        if (provsRes.error) console.error('Providers error:', JSON.stringify(provsRes.error));
        if (remRes.error) console.error('Reminders error:', JSON.stringify(remRes.error));

        if (docsRes.data) documents = docsRes.data.map(d => ({
          id: d.id,
          name: d.name,
          categoryId: d.category_id,
          notes: d.notes,
          fileType: d.file_type,
          fileName: d.file_name,
          fileUrl: d.file_url,
          createdAt: d.created_at
        }));

        if (provsRes.data) providers = provsRes.data.map(p => ({
          id: p.id,
          name: p.name,
          type: p.type,
          phone: p.phone,
          email: p.email,
          notes: p.notes,
          createdAt: p.created_at
        }));

        if (remRes.data) reminders = remRes.data.map(r => ({
          id: r.id,
          title: r.title,
          date: r.date,
          categoryId: r.category_id,
          notes: r.notes,
          completed: r.completed,
          createdAt: r.created_at
        }));

        console.log('Loaded from Supabase:', { documents: documents.length, providers: providers.length, reminders: reminders.length });
      } catch (err) {
        console.error('Error loading from Supabase:', err);
        alert('Error connecting to database: ' + err.message);
        // Fall back to localStorage
        documents = JSON.parse(localStorage.getItem('jestingshub-docs') || '[]');
        providers = JSON.parse(localStorage.getItem('jestingshub-providers') || '[]');
        reminders = JSON.parse(localStorage.getItem('jestingshub-reminders') || '[]');
      }

      isLoading = false;
      renderCategories();
      updateStats();
      renderRecentActivity();
      renderDashboardReminders();
      populateCategoryDropdown();
      populateProviderFilterDropdown();
      populateReminderCategoryDropdown();
      loadLogo();
      
      console.log('Init complete!');
    }

    // Populate provider filter dropdown
    function populateProviderFilterDropdown() {
      const select = document.getElementById('providerFilter');
      if (!select) return;
      select.innerHTML = '<option value="">All Types</option>' + 
        providerTypes.map(type => `<option value="${type}">${type}</option>`).join('');
    }

    // Populate reminder category dropdown
    function populateReminderCategoryDropdown() {
      const select = document.getElementById('reminderCategory');
      if (!select) return;
      select.innerHTML = '<option value="">None</option>' + 
        categories.filter(c => !c.isSpecial).map(cat => 
          `<option value="${cat.id}">${cat.name} - ${cat.subtitle}</option>`
        ).join('');
    }

    // Render Categories Grid
    function renderCategories() {
      const grid = document.getElementById('categoriesGrid');
      grid.innerHTML = categories.map((cat, i) => {
        let count;
        if (cat.id === 'providers') {
          count = providers.length;
        } else {
          count = documents.filter(d => d.categoryId === cat.id).length;
        }
        return `
          <div class="category-card" style="animation-delay: ${0.02 + i * 0.02}s" onclick="openCategory('${cat.id}')">
            <div class="category-icon ${cat.colorClass}">${cat.icon}</div>
            <div class="category-info">
              <span class="category-name">${cat.name}</span>
              <span class="category-subtitle">${cat.subtitle}</span>
            </div>
            <div class="category-badge">${count}</div>
          </div>
        `;
      }).join('');
    }

    // Open Category Detail
    function openCategory(categoryId) {
      // Special handling for Providers
      if (categoryId === 'providers') {
        openProvidersView();
        return;
      }

      currentCategory = categories.find(c => c.id === categoryId);
      if (!currentCategory) return;

      document.getElementById('dashboardView').classList.add('hidden');
      document.getElementById('categoryDetail').classList.add('active');

      const detailIcon = document.getElementById('detailIcon');
      detailIcon.className = 'detail-icon ' + currentCategory.colorClass;
      detailIcon.textContent = currentCategory.icon;

      document.getElementById('detailTitle').textContent = currentCategory.name;
      
      renderDocuments();
    }

    // Open Providers View
    function openProvidersView() {
      document.getElementById('dashboardView').classList.add('hidden');
      document.getElementById('providersView').classList.add('active');
      
      // Reset filters
      document.getElementById('providerSearch').value = '';
      document.getElementById('providerFilter').value = '';
      
      // Set view mode
      setProviderView(providerViewMode, false);
      
      renderProviders();
    }

    // Set Provider View Mode
    function setProviderView(mode, save = true) {
      providerViewMode = mode;
      if (save) localStorage.setItem('jestingshub-provider-view', mode);
      
      const grid = document.getElementById('providersGrid');
      const gridBtn = document.getElementById('gridViewBtn');
      const listBtn = document.getElementById('listViewBtn');
      
      if (mode === 'list') {
        grid.classList.add('list-view');
        gridBtn.classList.remove('active');
        listBtn.classList.add('active');
      } else {
        grid.classList.remove('list-view');
        gridBtn.classList.add('active');
        listBtn.classList.remove('active');
      }
    }

    // Filter Providers
    function filterProviders() {
      renderProviders();
    }

    // Get Filtered Providers
    function getFilteredProviders() {
      const searchTerm = document.getElementById('providerSearch').value.toLowerCase().trim();
      const typeFilter = document.getElementById('providerFilter').value;
      
      return providers.filter(p => {
        const matchesSearch = !searchTerm || 
          p.name.toLowerCase().includes(searchTerm) ||
          p.type.toLowerCase().includes(searchTerm) ||
          (p.phone && p.phone.includes(searchTerm)) ||
          (p.email && p.email.toLowerCase().includes(searchTerm)) ||
          (p.notes && p.notes.toLowerCase().includes(searchTerm));
        
        const matchesType = !typeFilter || p.type === typeFilter;
        
        return matchesSearch && matchesType;
      });
    }

    // Render Providers
    function renderProviders() {
      const grid = document.getElementById('providersGrid');
      const emptyState = document.getElementById('providersEmptyState');
      const noResults = document.getElementById('providersNoResults');
      const controls = document.querySelector('.providers-controls');

      document.getElementById('providersSubtitle').textContent = 
        `Service Contacts ¬∑ ${providers.length} provider${providers.length !== 1 ? 's' : ''}`;

      // No providers at all
      if (providers.length === 0) {
        grid.style.display = 'none';
        noResults.style.display = 'none';
        emptyState.style.display = 'block';
        controls.style.display = 'none';
        return;
      }

      controls.style.display = 'flex';
      emptyState.style.display = 'none';

      // Get filtered results
      const filtered = getFilteredProviders();
      
      // Update count
      document.getElementById('providersCount').textContent = 
        `${filtered.length} of ${providers.length} provider${providers.length !== 1 ? 's' : ''}`;

      // No results after filtering
      if (filtered.length === 0) {
        grid.style.display = 'none';
        noResults.style.display = 'block';
        return;
      }

      grid.style.display = 'grid';
      noResults.style.display = 'none';

      // Sort by type, then name
      const sorted = [...filtered].sort((a, b) => {
        if (a.type !== b.type) return a.type.localeCompare(b.type);
        return a.name.localeCompare(b.name);
      });

      grid.innerHTML = sorted.map(p => {
        const icon = providerIcons[p.type] || 'üë∑';
        return `
          <div class="provider-card">
            <div class="provider-actions">
              <button class="doc-action-btn" onclick="editProvider('${p.id}')" title="Edit">‚úé</button>
              <button class="doc-action-btn delete" onclick="deleteProvider('${p.id}')" title="Delete">üóë</button>
            </div>
            <div class="provider-header">
              <div class="provider-avatar">${icon}</div>
              <div class="provider-info">
                <div class="provider-name">${p.name}</div>
                <div class="provider-type">${p.type}</div>
              </div>
            </div>
            <div class="provider-contact">
              ${p.phone ? `<a href="tel:${p.phone}" class="provider-contact-row phone" onclick="event.stopPropagation()"><span>üìû</span>${formatPhone(p.phone)}</a>` : ''}
              ${p.email ? `<a href="mailto:${p.email}" class="provider-contact-row email" onclick="event.stopPropagation()"><span>‚úâÔ∏è</span>${p.email}</a>` : ''}
            </div>
            ${p.notes ? `<div class="provider-notes">${p.notes}</div>` : ''}
          </div>
        `;
      }).join('');
    }

    // Format phone number
    function formatPhone(phone) {
      const cleaned = phone.replace(/\D/g, '');
      if (cleaned.length === 10) {
        return `(${cleaned.slice(0,3)}) ${cleaned.slice(3,6)}-${cleaned.slice(6)}`;
      }
      return phone;
    }

    // Open Add Provider Modal
    function openAddProviderModal() {
      currentEditingProvider = null;
      document.getElementById('providerModalTitle').textContent = 'Add Provider';
      document.getElementById('providerName').value = '';
      document.getElementById('providerType').value = 'Plumber';
      document.getElementById('providerPhone').value = '';
      document.getElementById('providerEmail').value = '';
      document.getElementById('providerNotes').value = '';
      document.getElementById('providerModal').classList.add('active');
    }

    // Edit Provider
    function editProvider(id) {
      const provider = providers.find(p => p.id === id);
      if (!provider) return;

      currentEditingProvider = provider;
      document.getElementById('providerModalTitle').textContent = 'Edit Provider';
      document.getElementById('providerName').value = provider.name;
      document.getElementById('providerType').value = provider.type;
      document.getElementById('providerPhone').value = provider.phone || '';
      document.getElementById('providerEmail').value = provider.email || '';
      document.getElementById('providerNotes').value = provider.notes || '';
      document.getElementById('providerModal').classList.add('active');
    }

    // Save Provider
    async function saveProvider() {
      const name = document.getElementById('providerName').value.trim();
      const type = document.getElementById('providerType').value;
      const phone = document.getElementById('providerPhone').value.trim();
      const email = document.getElementById('providerEmail').value.trim();
      const notes = document.getElementById('providerNotes').value.trim();

      if (!name) {
        alert('Please enter a name');
        return;
      }

      if (!phone && !email) {
        alert('Please enter at least a phone or email');
        return;
      }

      try {
        if (currentEditingProvider) {
          // Update existing
          const { error } = await db.from('providers')
            .update({ name, type, phone: phone || null, email: email || null, notes: notes || null })
            .eq('id', currentEditingProvider.id);
          
          if (error) throw error;
          
          const index = providers.findIndex(p => p.id === currentEditingProvider.id);
          if (index !== -1) {
            providers[index] = { ...providers[index], name, type, phone, email, notes };
          }
        } else {
          // Add new
          const { data, error } = await db.from('providers')
            .insert([{ name, type, phone: phone || null, email: email || null, notes: notes || null }])
            .select();
          
          if (error) throw error;
          
          if (data && data[0]) {
            providers.unshift({
              id: data[0].id,
              name: data[0].name,
              type: data[0].type,
              phone: data[0].phone,
              email: data[0].email,
              notes: data[0].notes,
              createdAt: data[0].created_at
            });
          }
        }

        closeModal('providerModal');
        renderProviders();
        renderCategories();
      } catch (err) {
        console.error('Error saving provider:', err);
        alert('Error saving provider. Please try again.');
      }
    }

    // Delete Provider
    async function deleteProvider(id) {
      if (confirm('Delete this provider?')) {
        try {
          const { error } = await db.from('providers').delete().eq('id', id);
          if (error) throw error;
          
          providers = providers.filter(p => p.id !== id);
          renderProviders();
          renderCategories();
        } catch (err) {
          console.error('Error deleting provider:', err);
          alert('Error deleting provider. Please try again.');
        }
      }
    }

    // Render Documents in Category
    function renderDocuments() {
      const categoryDocs = documents.filter(d => d.categoryId === currentCategory.id);
      const grid = document.getElementById('documentsGrid');
      const emptyState = document.getElementById('emptyState');

      document.getElementById('detailSubtitle').textContent = 
        `${currentCategory.subtitle} ¬∑ ${categoryDocs.length} document${categoryDocs.length !== 1 ? 's' : ''}`;

      if (categoryDocs.length === 0) {
        grid.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }

      grid.style.display = 'grid';
      emptyState.style.display = 'none';

      grid.innerHTML = categoryDocs.map(doc => {
        const typeClass = getFileTypeClass(doc.fileType);
        const typeIcon = getFileTypeIcon(doc.fileType);
        return `
          <div class="document-card" onclick="viewDocument('${doc.id}')">
            <div class="doc-actions">
              <button class="doc-action-btn delete" onclick="event.stopPropagation(); deleteDocument('${doc.id}')">üóë</button>
            </div>
            <div class="document-card-header">
              <div class="doc-type-icon ${typeClass}">${typeIcon}</div>
              <div class="doc-info">
                <div class="doc-name">${doc.name}</div>
                <div class="doc-meta">${formatDate(doc.createdAt)}</div>
              </div>
            </div>
            ${doc.notes ? `<div class="doc-notes">${doc.notes}</div>` : ''}
          </div>
        `;
      }).join('');
    }

    // Go Back to Dashboard
    function goBackToDashboard() {
      document.getElementById('categoryDetail').classList.remove('active');
      document.getElementById('providersView').classList.remove('active');
      document.getElementById('remindersView').classList.remove('active');
      document.getElementById('searchView').classList.remove('active');
      document.getElementById('dashboardView').classList.remove('hidden');
      currentCategory = null;
      renderCategories();
      updateStats();
      renderRecentActivity();
      renderDashboardReminders();
    }

    // Open Add Document Modal
    function openAddDocModal() {
      document.getElementById('addDocModal').classList.add('active');
      document.getElementById('docName').value = '';
      document.getElementById('docNotes').value = '';
      document.getElementById('docFile').value = '';
      document.getElementById('fileUploadArea').classList.remove('has-file');
      document.getElementById('fileUploadText').textContent = 'Click to upload or drag & drop';
      selectedFile = null;

      if (currentCategory) {
        document.getElementById('docCategory').value = currentCategory.id;
      }
    }

    // Populate Category Dropdown
    function populateCategoryDropdown() {
      const select = document.getElementById('docCategory');
      select.innerHTML = categories
        .filter(cat => !cat.isSpecial)
        .map(cat => `<option value="${cat.id}">${cat.name} - ${cat.subtitle}</option>`)
        .join('');
    }

    // Handle File Select
    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (file) {
        selectedFile = file;
        document.getElementById('fileUploadArea').classList.add('has-file');
        document.getElementById('fileUploadText').textContent = file.name;
        
        if (!document.getElementById('docName').value) {
          document.getElementById('docName').value = file.name.replace(/\.[^/.]+$/, '');
        }
      }
    }

    // Save Document
    async function saveDocument() {
      console.log('saveDocument called');
      
      const name = document.getElementById('docName').value.trim();
      const categoryId = document.getElementById('docCategory').value;
      const notes = document.getElementById('docNotes').value.trim();

      console.log('Doc data:', { name, categoryId, notes });

      if (!name) {
        alert('Please enter a document name');
        return;
      }

      let fileUrl = null;
      let fileType = null;
      let fileName = null;

      // Upload file to Supabase Storage if selected
      if (selectedFile) {
        try {
          const fileExt = selectedFile.name.split('.').pop();
          const uniqueName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;
          
          console.log('Uploading file:', uniqueName);
          
          const { data: uploadData, error: uploadError } = await db.storage
            .from('documents')
            .upload(uniqueName, selectedFile);

          if (uploadError) {
            console.error('Upload error:', uploadError);
            alert('Error uploading file: ' + uploadError.message);
            return;
          }

          // Get public URL
          const { data: urlData } = db.storage
            .from('documents')
            .getPublicUrl(uniqueName);

          fileUrl = urlData.publicUrl;
          fileType = selectedFile.type;
          fileName = selectedFile.name;
          
          console.log('File uploaded:', fileUrl);
        } catch (err) {
          console.error('File upload error:', err);
          alert('Error uploading file. Please try again.');
          return;
        }
      }

      const doc = {
        name,
        category_id: categoryId,
        notes: notes || null,
        file_type: fileType,
        file_name: fileName,
        file_url: fileUrl
      };

      console.log('Inserting doc:', doc);

      try {
        const { data, error } = await db.from('documents').insert([doc]).select();
        
        console.log('Insert result:', { data, error });
        
        if (error) {
          console.error('Supabase error:', error);
          alert('Database error: ' + error.message);
          return;
        }
        
        if (data && data[0]) {
          documents.unshift({
            id: data[0].id,
            name: data[0].name,
            categoryId: data[0].category_id,
            notes: data[0].notes,
            fileType: data[0].file_type,
            fileName: data[0].file_name,
            fileUrl: data[0].file_url,
            createdAt: data[0].created_at
          });
          console.log('Document added to local array');
        }

        closeModal('addDocModal');
        if (currentCategory && currentCategory.id === categoryId) {
          renderDocuments();
        }
        renderCategories();
        updateStats();
        renderRecentActivity();
        console.log('Save complete!');
      } catch (err) {
        console.error('Error saving document:', err);
        alert('Error saving document: ' + err.message);
      }
    }

    // View Document
    function viewDocument(docId) {
      const doc = documents.find(d => d.id === docId);
      if (!doc) return;

      currentViewingDoc = doc;
      const cat = categories.find(c => c.id === doc.categoryId);

      document.getElementById('viewDocTitle').textContent = doc.name;
      document.getElementById('viewDocCategory').textContent = cat ? `${cat.name} - ${cat.subtitle}` : '‚Äî';
      document.getElementById('viewDocDate').textContent = formatDate(doc.createdAt);
      document.getElementById('viewDocNotes').textContent = doc.notes || '‚Äî';

      const preview = document.getElementById('viewDocPreview');
      if (doc.fileUrl && doc.fileType && doc.fileType.startsWith('image/')) {
        preview.innerHTML = `
          <img src="${doc.fileUrl}" alt="${doc.name}" style="max-width: 100%; border-radius: 8px;">
          <a href="${doc.fileUrl}" target="_blank" class="btn btn-secondary" style="margin-top: 12px;">Open Full Size</a>
        `;
      } else if (doc.fileUrl) {
        preview.innerHTML = `
          <div class="preview-icon">${getFileTypeIcon(doc.fileType)}</div>
          <div class="file-upload-text">${doc.fileName || 'File attached'}</div>
          <a href="${doc.fileUrl}" target="_blank" class="btn btn-primary" style="margin-top: 12px;">View / Download File</a>
        `;
      } else {
        preview.innerHTML = `
          <div class="preview-icon">üìÑ</div>
          <div class="file-upload-text">No file attached</div>
        `;
      }

      document.getElementById('viewDocModal').classList.add('active');
    }

    // Delete Document
    async function deleteDocument(docId) {
      if (confirm('Delete this document?')) {
        try {
          // Find the document to get file URL
          const doc = documents.find(d => d.id === docId);
          
          // Delete from database
          const { error } = await db.from('documents').delete().eq('id', docId);
          if (error) throw error;
          
          // Delete file from storage if exists
          if (doc && doc.fileUrl) {
            const fileName = doc.fileUrl.split('/').pop();
            await db.storage.from('documents').remove([fileName]);
          }
          
          documents = documents.filter(d => d.id !== docId);
          if (currentCategory) {
            renderDocuments();
          }
          renderCategories();
          updateStats();
          renderRecentActivity();
        } catch (err) {
          console.error('Error deleting document:', err);
          alert('Error deleting document. Please try again.');
        }
      }
    }

    // Delete Current Doc (from view modal)
    function deleteCurrentDoc() {
      if (currentViewingDoc) {
        deleteDocument(currentViewingDoc.id);
        closeModal('viewDocModal');
        currentViewingDoc = null;
      }
    }

    // Update Stats
    function updateStats() {
      document.getElementById('totalDocs').textContent = documents.length;
      
      const now = new Date();
      const thisMonth = documents.filter(d => {
        const docDate = new Date(d.createdAt);
        return docDate.getMonth() === now.getMonth() && docDate.getFullYear() === now.getFullYear();
      }).length;
      document.getElementById('thisMonthDocs').textContent = thisMonth;
      
      // Count active reminders
      const activeReminders = reminders.filter(r => !r.completed).length;
      document.getElementById('upcomingCount').textContent = activeReminders;
    }

    // Render Recent Activity
    function renderRecentActivity() {
      const recent = [...documents]
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .slice(0, 3);

      const container = document.getElementById('recentActivity');
      
      if (recent.length === 0) {
        container.innerHTML = '<div style="color: var(--text-tertiary); font-size: 14px;">No recent activity</div>';
        return;
      }

      container.innerHTML = recent.map(doc => {
        const cat = categories.find(c => c.id === doc.categoryId);
        return `
          <div class="activity-item">
            <div class="activity-dot"></div>
            <div class="activity-content">
              <span class="activity-text">${doc.name}</span>
              <span class="activity-meta">${formatTimeAgo(doc.createdAt)} ¬∑ ${cat ? cat.name : ''}</span>
            </div>
          </div>
        `;
      }).join('');
    }

    // Helpers
    function getFileTypeClass(mimeType) {
      if (!mimeType) return '';
      if (mimeType.includes('pdf')) return 'pdf';
      if (mimeType.includes('image')) return 'image';
      if (mimeType.includes('word') || mimeType.includes('document')) return 'doc';
      return '';
    }

    function getFileTypeIcon(mimeType) {
      if (!mimeType) return 'üìÑ';
      if (mimeType.includes('pdf')) return 'üìï';
      if (mimeType.includes('image')) return 'üñº';
      if (mimeType.includes('word') || mimeType.includes('document')) return 'üìò';
      return 'üìÑ';
    }

    function formatDate(isoString) {
      return new Date(isoString).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    function formatTimeAgo(isoString) {
      const diff = Date.now() - new Date(isoString).getTime();
      const mins = Math.floor(diff / 60000);
      if (mins < 60) return mins <= 1 ? 'Just now' : `${mins} mins ago`;
      const hours = Math.floor(mins / 60);
      if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
      const days = Math.floor(hours / 24);
      if (days < 7) return days === 1 ? 'Yesterday' : `${days} days ago`;
      return formatDate(isoString);
    }

    // Modal Helpers
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    function toggleEmergency() { document.getElementById('emergencyModal').classList.toggle('active'); }
    function showComplaint() { document.getElementById('complaintModal').classList.add('active'); }
    function showHusband() { document.getElementById('husbandModal').classList.add('active'); }

    // ========== REMINDERS ==========
    
    // Get reminder urgency status
    function getReminderStatus(dateStr) {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const reminderDate = new Date(dateStr);
      reminderDate.setHours(0, 0, 0, 0);
      
      const diffDays = Math.ceil((reminderDate - today) / (1000 * 60 * 60 * 24));
      
      if (diffDays < 0) return 'overdue';
      if (diffDays <= 7) return 'urgent';
      if (diffDays <= 30) return 'upcoming';
      return 'later';
    }

    // Get status label
    function getStatusLabel(status) {
      switch(status) {
        case 'overdue': return 'Overdue';
        case 'urgent': return 'This Week';
        case 'upcoming': return 'Soon';
        default: return '';
      }
    }

    // Format reminder date for display
    function formatReminderDate(dateStr) {
      const date = new Date(dateStr);
      return {
        month: date.toLocaleDateString('en-US', { month: 'short' }),
        day: date.getDate()
      };
    }

    // Open Reminders View
    function openRemindersView() {
      document.getElementById('dashboardView').classList.add('hidden');
      document.getElementById('remindersView').classList.add('active');
      renderReminders();
    }

    // Render Reminders (full view)
    function renderReminders() {
      const list = document.getElementById('remindersList');
      const emptyState = document.getElementById('remindersEmptyState');

      const activeReminders = reminders.filter(r => !r.completed);
      
      document.getElementById('remindersSubtitle').textContent = 
        `Upcoming ¬∑ ${activeReminders.length} reminder${activeReminders.length !== 1 ? 's' : ''}`;

      if (activeReminders.length === 0) {
        list.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }

      list.style.display = 'flex';
      emptyState.style.display = 'none';

      // Sort by date
      const sorted = [...activeReminders].sort((a, b) => new Date(a.date) - new Date(b.date));

      // Group by status
      const grouped = {
        overdue: sorted.filter(r => getReminderStatus(r.date) === 'overdue'),
        urgent: sorted.filter(r => getReminderStatus(r.date) === 'urgent'),
        upcoming: sorted.filter(r => getReminderStatus(r.date) === 'upcoming'),
        later: sorted.filter(r => getReminderStatus(r.date) === 'later')
      };

      let html = '';

      if (grouped.overdue.length > 0) {
        html += '<div class="reminders-section-title">‚ö†Ô∏è Overdue</div>';
        html += grouped.overdue.map(r => renderReminderCard(r)).join('');
      }

      if (grouped.urgent.length > 0) {
        html += '<div class="reminders-section-title">üî• This Week</div>';
        html += grouped.urgent.map(r => renderReminderCard(r)).join('');
      }

      if (grouped.upcoming.length > 0) {
        html += '<div class="reminders-section-title">üìÖ This Month</div>';
        html += grouped.upcoming.map(r => renderReminderCard(r)).join('');
      }

      if (grouped.later.length > 0) {
        html += '<div class="reminders-section-title">üìÜ Later</div>';
        html += grouped.later.map(r => renderReminderCard(r)).join('');
      }

      list.innerHTML = html;
    }

    // Render single reminder card
    function renderReminderCard(r) {
      const status = getReminderStatus(r.date);
      const dateFormatted = formatReminderDate(r.date);
      const cat = r.categoryId ? categories.find(c => c.id === r.categoryId) : null;

      return `
        <div class="reminder-card ${status}">
          <div class="reminder-date-box ${status}">
            <span class="reminder-date-month">${dateFormatted.month}</span>
            <span class="reminder-date-day">${dateFormatted.day}</span>
          </div>
          <div class="reminder-content">
            <div class="reminder-title">${r.title}</div>
            <div class="reminder-meta">
              ${cat ? `<span class="reminder-link" onclick="openCategory('${cat.id}')">${cat.name}</span>` : ''}
              ${r.notes ? `<span>${r.notes}</span>` : ''}
            </div>
          </div>
          ${status !== 'later' ? `<span class="reminder-status ${status}">${getStatusLabel(status)}</span>` : ''}
          <div class="reminder-actions">
            <button class="doc-action-btn" onclick="editReminder('${r.id}')" title="Edit">‚úé</button>
            <button class="doc-action-btn" onclick="completeReminder('${r.id}')" title="Mark Done">‚úì</button>
            <button class="doc-action-btn delete" onclick="deleteReminder('${r.id}')" title="Delete">üóë</button>
          </div>
        </div>
      `;
    }

    // Render Dashboard Reminders (compact)
    function renderDashboardReminders() {
      const container = document.getElementById('dashboardReminders');
      if (!container) return;

      const activeReminders = reminders
        .filter(r => !r.completed)
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .slice(0, 4);

      if (activeReminders.length === 0) {
        container.innerHTML = '<div style="color: var(--text-tertiary); font-size: 14px; padding: 8px 0;">No upcoming reminders</div>';
        return;
      }

      container.innerHTML = activeReminders.map(r => {
        const status = getReminderStatus(r.date);
        const dateFormatted = formatReminderDate(r.date);
        return `
          <div class="reminder-item clickable" onclick="openRemindersView()">
            <div class="reminder-date ${status === 'overdue' || status === 'urgent' ? 'urgent' : ''}">${dateFormatted.month} ${dateFormatted.day}</div>
            <span class="reminder-text">${r.title}</span>
            ${status === 'overdue' ? '<span class="urgent-badge">Overdue</span>' : ''}
            ${status === 'urgent' ? '<span class="urgent-badge">Soon</span>' : ''}
          </div>
        `;
      }).join('');
    }

    // Open Add Reminder Modal
    function openAddReminderModal() {
      currentEditingReminder = null;
      document.getElementById('reminderModalTitle').textContent = 'Add Reminder';
      document.getElementById('reminderTitle').value = '';
      document.getElementById('reminderDate').value = '';
      document.getElementById('reminderCategory').value = '';
      document.getElementById('reminderNotes').value = '';
      document.getElementById('reminderModal').classList.add('active');
    }

    // Edit Reminder
    function editReminder(id) {
      const reminder = reminders.find(r => r.id === id);
      if (!reminder) return;

      currentEditingReminder = reminder;
      document.getElementById('reminderModalTitle').textContent = 'Edit Reminder';
      document.getElementById('reminderTitle').value = reminder.title;
      document.getElementById('reminderDate').value = reminder.date;
      document.getElementById('reminderCategory').value = reminder.categoryId || '';
      document.getElementById('reminderNotes').value = reminder.notes || '';
      document.getElementById('reminderModal').classList.add('active');
    }

    // Save Reminder
    async function saveReminder() {
      const title = document.getElementById('reminderTitle').value.trim();
      const date = document.getElementById('reminderDate').value;
      const categoryId = document.getElementById('reminderCategory').value;
      const notes = document.getElementById('reminderNotes').value.trim();

      if (!title) {
        alert('Please enter a title');
        return;
      }

      if (!date) {
        alert('Please select a date');
        return;
      }

      try {
        if (currentEditingReminder) {
          // Update existing
          const { error } = await db.from('reminders')
            .update({ title, date, category_id: categoryId || null, notes: notes || null })
            .eq('id', currentEditingReminder.id);
          
          if (error) throw error;
          
          const index = reminders.findIndex(r => r.id === currentEditingReminder.id);
          if (index !== -1) {
            reminders[index] = { ...reminders[index], title, date, categoryId, notes };
          }
        } else {
          // Add new
          const { data, error } = await db.from('reminders')
            .insert([{ title, date, category_id: categoryId || null, notes: notes || null, completed: false }])
            .select();
          
          if (error) throw error;
          
          if (data && data[0]) {
            reminders.push({
              id: data[0].id,
              title: data[0].title,
              date: data[0].date,
              categoryId: data[0].category_id,
              notes: data[0].notes,
              completed: data[0].completed,
              createdAt: data[0].created_at
            });
          }
        }

        closeModal('reminderModal');
        
        // Update views
        if (document.getElementById('remindersView').classList.contains('active')) {
          renderReminders();
        }
        renderDashboardReminders();
        updateStats();
      } catch (err) {
        console.error('Error saving reminder:', err);
        alert('Error saving reminder. Please try again.');
      }
    }

    // Complete Reminder
    async function completeReminder(id) {
      try {
        const { error } = await db.from('reminders').update({ completed: true }).eq('id', id);
        if (error) throw error;
        
        const index = reminders.findIndex(r => r.id === id);
        if (index !== -1) {
          reminders[index].completed = true;
        }
        renderReminders();
        renderDashboardReminders();
        updateStats();
      } catch (err) {
        console.error('Error completing reminder:', err);
        alert('Error updating reminder. Please try again.');
      }
    }

    // Delete Reminder
    async function deleteReminder(id) {
      if (confirm('Delete this reminder?')) {
        try {
          const { error } = await db.from('reminders').delete().eq('id', id);
          if (error) throw error;
          
          reminders = reminders.filter(r => r.id !== id);
          renderReminders();
          renderDashboardReminders();
          updateStats();
        } catch (err) {
          console.error('Error deleting reminder:', err);
          alert('Error deleting reminder. Please try again.');
        }
      }
    }

    // Export Reminders to iCal (.ics)
    function exportToICal() {
      const activeReminders = reminders.filter(r => !r.completed);
      
      if (activeReminders.length === 0) {
        alert('No reminders to export!');
        return;
      }

      let icsContent = [
        'BEGIN:VCALENDAR',
        'VERSION:2.0',
        'PRODID:-//JestingsHub//Reminders//EN',
        'CALSCALE:GREGORIAN',
        'METHOD:PUBLISH'
      ];

      activeReminders.forEach(r => {
        const dateStr = r.date.replace(/-/g, '');
        const uid = `${r.id}@jestingshub`;
        const now = new Date().toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        
        icsContent.push(
          'BEGIN:VEVENT',
          `UID:${uid}`,
          `DTSTAMP:${now}`,
          `DTSTART;VALUE=DATE:${dateStr}`,
          `SUMMARY:${r.title.replace(/,/g, '\\,')}`,
          r.notes ? `DESCRIPTION:${r.notes.replace(/,/g, '\\,').replace(/\n/g, '\\n')}` : '',
          'BEGIN:VALARM',
          'ACTION:DISPLAY',
          'TRIGGER:-P1D',
          `DESCRIPTION:Reminder: ${r.title}`,
          'END:VALARM',
          'END:VEVENT'
        );
      });

      icsContent.push('END:VCALENDAR');
      
      // Filter out empty lines and join
      const icsString = icsContent.filter(line => line).join('\r\n');
      
      // Download file
      const blob = new Blob([icsString], { type: 'text/calendar;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'jestingshub-reminders.ics';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // ========== SEARCH ==========
    
    // Open Search View
    function openSearchView() {
      document.getElementById('dashboardView').classList.add('hidden');
      document.getElementById('searchView').classList.add('active');
      document.getElementById('searchInputLarge').value = '';
      document.getElementById('searchInputLarge').focus();
      document.getElementById('searchEmpty').style.display = 'block';
      document.getElementById('searchResults').style.display = 'none';
    }

    // Open Search from Dashboard
    function openSearchFromDashboard() {
      const query = document.getElementById('dashboardSearch').value.trim();
      if (query) {
        askAI(query);
      }
    }

    // Handle search keydown
    function handleSearchKeydown(event) {
      if (event.key === 'Enter') {
        openSearchFromDashboard();
      }
    }

    // Ask AI (Claude) - via server
    async function askAI(query) {
      // Show loading state
      showAIModal('Thinking...', true);
      
      // Build context from all data
      const docsContext = documents.map(d => {
        const cat = categories.find(c => c.id === d.categoryId);
        return `- ${d.name} (Category: ${cat ? cat.name + ' - ' + cat.subtitle : 'Unknown'}, Notes: ${d.notes || 'none'}, Added: ${formatDate(d.createdAt)})`;
      }).join('\n');
      
      const providersContext = providers.map(p => 
        `- ${p.name} (${p.type}): Phone: ${p.phone || 'none'}, Email: ${p.email || 'none'}, Notes: ${p.notes || 'none'}`
      ).join('\n');
      
      const remindersContext = reminders.filter(r => !r.completed).map(r => {
        const cat = categories.find(c => c.id === r.categoryId);
        return `- ${r.title}: Due ${r.date}, Category: ${cat ? cat.name : 'none'}, Notes: ${r.notes || 'none'}`;
      }).join('\n');

      try {
        const response = await fetch('/api/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query,
            documents: docsContext || 'No documents yet',
            providers: providersContext || 'No providers yet',
            reminders: remindersContext || 'No reminders yet'
          })
        });

        const data = await response.json();
        
        if (data.error) {
          showAIModal('Error: ' + data.error, false);
          return;
        }
        
        showAIModal(data.answer, false);
      } catch (err) {
        console.error('AI Error:', err);
        showAIModal('Sorry, I couldn\'t connect to the AI. Please try again.', false);
      }
    }

    // Show AI Response Modal
    function showAIModal(message, isLoading) {
      let modal = document.getElementById('aiModal');
      if (!modal) {
        modal = document.createElement('div');
        modal.id = 'aiModal';
        modal.className = 'modal active';
        modal.innerHTML = `
          <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
              <span class="modal-title">ü§ñ JestingsHub AI</span>
              <button class="modal-close" onclick="closeModal('aiModal')">√ó</button>
            </div>
            <div id="aiResponse" style="padding: 20px; line-height: 1.6; white-space: pre-wrap;"></div>
            <div style="padding: 0 20px 20px;">
              <button class="btn btn-primary" onclick="closeModal('aiModal')" style="width: 100%;">Got it</button>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
      } else {
        modal.classList.add('active');
      }
      
      const responseDiv = document.getElementById('aiResponse');
      if (isLoading) {
        responseDiv.innerHTML = '<div style="text-align: center;">ü§î Thinking...</div>';
      } else {
        responseDiv.textContent = message;
      }
    }

    // Search for suggestion
    function searchFor(term) {
      document.getElementById('searchInputLarge').value = term;
      performSearch();
    }

    // Perform Search
    function performSearch() {
      const query = document.getElementById('searchInputLarge').value.trim().toLowerCase();
      
      if (!query) {
        document.getElementById('searchEmpty').style.display = 'block';
        document.getElementById('searchResults').style.display = 'none';
        return;
      }

      document.getElementById('searchEmpty').style.display = 'none';
      document.getElementById('searchResults').style.display = 'block';

      // Search Documents
      const docResults = documents.filter(d => 
        d.name.toLowerCase().includes(query) ||
        (d.notes && d.notes.toLowerCase().includes(query)) ||
        (d.fileName && d.fileName.toLowerCase().includes(query))
      ).map(d => ({
        type: 'document',
        data: d,
        category: categories.find(c => c.id === d.categoryId)
      }));

      // Search Providers
      const providerResults = providers.filter(p =>
        p.name.toLowerCase().includes(query) ||
        p.type.toLowerCase().includes(query) ||
        (p.phone && p.phone.includes(query)) ||
        (p.email && p.email.toLowerCase().includes(query)) ||
        (p.notes && p.notes.toLowerCase().includes(query))
      ).map(p => ({
        type: 'provider',
        data: p
      }));

      // Search Reminders
      const reminderResults = reminders.filter(r =>
        !r.completed && (
          r.title.toLowerCase().includes(query) ||
          (r.notes && r.notes.toLowerCase().includes(query))
        )
      ).map(r => ({
        type: 'reminder',
        data: r,
        category: r.categoryId ? categories.find(c => c.id === r.categoryId) : null
      }));

      const totalResults = docResults.length + providerResults.length + reminderResults.length;

      let html = `<div class="search-results-summary">Found <strong>${totalResults}</strong> result${totalResults !== 1 ? 's' : ''} for "<strong>${escapeHtml(query)}</strong>"</div>`;

      if (totalResults === 0) {
        html += `
          <div class="search-empty">
            <div class="search-empty-icon">üîç</div>
            <h3>No results found</h3>
            <p>Try different keywords or check spelling</p>
          </div>
        `;
      } else {
        // Documents section
        if (docResults.length > 0) {
          html += `
            <div class="search-section">
              <div class="search-section-title">
                üìÑ Documents <span class="search-section-count">${docResults.length}</span>
              </div>
              <div class="search-results-grid">
                ${docResults.map(r => renderDocResult(r, query)).join('')}
              </div>
            </div>
          `;
        }

        // Providers section
        if (providerResults.length > 0) {
          html += `
            <div class="search-section">
              <div class="search-section-title">
                üìû Providers <span class="search-section-count">${providerResults.length}</span>
              </div>
              <div class="search-results-grid">
                ${providerResults.map(r => renderProviderResult(r, query)).join('')}
              </div>
            </div>
          `;
        }

        // Reminders section
        if (reminderResults.length > 0) {
          html += `
            <div class="search-section">
              <div class="search-section-title">
                üîî Reminders <span class="search-section-count">${reminderResults.length}</span>
              </div>
              <div class="search-results-grid">
                ${reminderResults.map(r => renderReminderResult(r, query)).join('')}
              </div>
            </div>
          `;
        }
      }

      document.getElementById('searchResults').innerHTML = html;
    }

    // Render document result
    function renderDocResult(r, query) {
      const cat = r.category;
      const icon = getFileTypeIcon(r.data.fileType);
      return `
        <div class="search-result-item" onclick="goToDocFromSearch('${r.data.categoryId}', '${r.data.id}')">
          <div class="search-result-icon" style="background: ${cat ? `var(--${cat.colorClass})` : 'var(--bg-primary)'};">${icon}</div>
          <div class="search-result-content">
            <div class="search-result-title">${highlightMatch(r.data.name, query)}</div>
            <div class="search-result-meta">
              ${cat ? cat.name + ' ¬∑ ' : ''}${formatDate(r.data.createdAt)}
              ${r.data.notes ? ' ¬∑ ' + highlightMatch(truncate(r.data.notes, 40), query) : ''}
            </div>
          </div>
          ${cat ? `<span class="search-result-badge">${cat.name}</span>` : ''}
        </div>
      `;
    }

    // Render provider result
    function renderProviderResult(r, query) {
      const icon = providerIcons[r.data.type] || 'üë∑';
      return `
        <div class="search-result-item" onclick="goToProviderFromSearch('${r.data.id}')">
          <div class="search-result-icon" style="background: var(--cat-providers);">${icon}</div>
          <div class="search-result-content">
            <div class="search-result-title">${highlightMatch(r.data.name, query)}</div>
            <div class="search-result-meta">
              ${highlightMatch(r.data.type, query)}
              ${r.data.phone ? ' ¬∑ ' + highlightMatch(formatPhone(r.data.phone), query) : ''}
            </div>
          </div>
          <span class="search-result-badge">Provider</span>
        </div>
      `;
    }

    // Render reminder result
    function renderReminderResult(r, query) {
      const status = getReminderStatus(r.data.date);
      const dateFormatted = formatReminderDate(r.data.date);
      return `
        <div class="search-result-item" onclick="goToReminderFromSearch('${r.data.id}')">
          <div class="search-result-icon ${status}" style="background: ${status === 'overdue' ? '#FFEBE9' : status === 'urgent' ? '#FFF3E0' : '#E3F2FD'};">üîî</div>
          <div class="search-result-content">
            <div class="search-result-title">${highlightMatch(r.data.title, query)}</div>
            <div class="search-result-meta">
              Due ${dateFormatted.month} ${dateFormatted.day}
              ${r.data.notes ? ' ¬∑ ' + highlightMatch(truncate(r.data.notes, 40), query) : ''}
            </div>
          </div>
          <span class="search-result-badge" style="${status === 'overdue' ? 'background: var(--emergency-red); color: white;' : ''}">${status === 'overdue' ? 'Overdue' : 'Reminder'}</span>
        </div>
      `;
    }

    // Navigate to document from search
    function goToDocFromSearch(categoryId, docId) {
      openCategory(categoryId);
      // Small delay then open doc view
      setTimeout(() => viewDocument(docId), 100);
    }

    // Navigate to provider from search
    function goToProviderFromSearch(providerId) {
      openProvidersView();
    }

    // Navigate to reminder from search
    function goToReminderFromSearch(reminderId) {
      openRemindersView();
    }

    // Highlight matching text
    function highlightMatch(text, query) {
      if (!text || !query) return text || '';
      const regex = new RegExp(`(${escapeRegex(query)})`, 'gi');
      return text.replace(regex, '<mark>$1</mark>');
    }

    // Escape regex special chars
    function escapeRegex(str) {
      return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // Escape HTML
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // Truncate string
    function truncate(str, len) {
      if (!str) return '';
      return str.length > len ? str.substring(0, len) + '...' : str;
    }

    // Logo Upload
    function handleLogoUpload(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('logoDefault').style.display = 'none';
          const logoImage = document.getElementById('logoImage');
          logoImage.src = e.target.result;
          logoImage.style.display = 'block';
          localStorage.setItem('jestingshub-logo', e.target.result);
        };
        reader.readAsDataURL(file);
      }
    }

    function loadLogo() {
      const savedLogo = localStorage.getItem('jestingshub-logo');
      if (savedLogo) {
        document.getElementById('logoDefault').style.display = 'none';
        const logoImage = document.getElementById('logoImage');
        logoImage.src = savedLogo;
        logoImage.style.display = 'block';
      }
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
